<p>q and w rotate<p id=score>0<div id=board style=position:absolute;top:80px></div><script>var e=0;nextPiece=()=>(e=e<o.length-1?e+1:0,o[e]);const o=[[{x:0,y:-1},{x:0,y:0},{x:1,y:0},{x:-1,y:0}],[{x:0,y:-2},{x:0,y:-1},{x:0,y:0},{x:0,y:1}],[{x:1,y:0},{x:0,y:0},{x:2,y:0},{x:0,y:-1}],[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],[{x:0,y:0},{x:-1,y:0},{x:0,y:1},{x:1,y:1}]],r=[1e3,800,600,400,300,250,200,150,100,90,80,70,60,50,40,30,20];var c=0,i=0;const t=document.getElementById("board");p={p:{x:5,y:1},b:[{x:0,y:-1},{x:0,y:0},{x:1,y:0},{x:-1,y:0}],reset(){p.p={x:5,y:1},p.b=nextPiece(),!p.coordinates().every((e=>!n[e.x][e.y]||"red"==n[e.x][e.y].style.background))&&endGame()},coordinates:()=>p.b.map((e=>({x:e.x+p.p.x,y:e.y+p.p.y})))};const n=[];for(var y=0;y<10;y++){for(var s=[],a=0;a<20;a++){var d=document.createElement("div");d.style.cssText="outline:thin solid;height:10px;width:10px;background:red;position:absolute",d.style.left=10*y+5+"px",d.style.top=10*a+5+"px",s.push(d),t.appendChild(d)}n.push(s)}renderPiece=e=>{p.coordinates().forEach((o=>n[o.x][o.y]&&(n[o.x][o.y].style.background=e)))},drop=()=>{p.coordinates().every((e=>e.y+1<20))&&p.coordinates().every((e=>"blue"!=n[e.x][e.y+1].style.background))?movePiece(0,1):freeze()},strafe=e=>{p.coordinates().every((o=>o.x+e<10&&o.x+e>=0))&&p.coordinates().every((o=>"blue"!=n[o.x+e][o.y].style.background))&&movePiece(e,0)},freeze=()=>{p.coordinates().forEach((e=>n[e.x][e.y].style.background="blue")),lookForRows(),p.reset()},lookForRows=()=>{[...n[0].keys()].filter((e=>n.every((o=>"blue"==o[e].style.background)))).forEach((e=>{removeLine(e),compressAbove(e),addPoint()}))},compressAbove=e=>{var o=[];n.forEach(((r,c)=>{r.forEach(((r,i)=>{i<=e&&"blue"==n[c][i].style.background&&o.push({x:c,y:i})}))})),o.forEach((e=>{n[e.x][e.y].style.background="red"})),o.forEach((e=>{n[e.x][e.y+1].style.background="blue"}))},removeLine=e=>{n.forEach((o=>o[e].style.background="red"))},changePiece=(e,o)=>{p.p.x+=e,p.p.y+=o},movePiece=(e,o)=>{renderPiece("red"),changePiece(e,o),renderPiece("yellow")},turn=e=>{var o=[];for(let t=0;t<p.b.length;t++){var r=p.b[t].x,c=p.b[t].y,i={};1==e?(i.x=-c,i.y=r):(i.x=c,i.y=-r),o.push(i)}o.every((e=>e.x+p.p.x<10&&e.x+p.p.x>=0&&e.y+p.p.y<20&&"blue"!=n[e.x+p.p.x][e.y+p.p.y].style.background))&&(renderPiece("red"),p.b=o,renderPiece("yellow"))},addPoint=()=>{c++,document.getElementById("score").innerText=c,c-10*i>10&&levelUp()},levelUp=()=>{clearInterval(x),i++,x=window.setInterval(drop,r[i])},endGame=()=>{clearInterval(x),n.forEach((e=>{e.forEach((e=>{"red"==e.style.background&&(e.style.background="black")}))}))},document.onkeydown=function(e){switch(e.keyCode){case 37:strafe(-1);break;case 87:turn(1);break;case 81:turn(-1);break;case 39:strafe(1);break;case 40:drop()}};var x=window.setInterval(drop,1e3)</script>